@extends('layouts.app')

@section('title', 'System Settings')
@section('page-title', 'System Settings')

@section('content')
<div class="container-fluid">
    <div class="card">
        <div class="card-body">
            @if(session('success'))
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    {{ session('success') }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            @endif

            @if(session('error'))
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    {{ session('error') }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            @endif

            <form action="{{ route('admin.settings.update') }}" method="POST">
                @csrf
                @method('PUT')

                {{-- Navigation Tabs --}}
                <ul class="nav nav-tabs mb-3" role="tablist">
                    <li class="nav-item">
                        <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button">
                            <i class="fas fa-cog"></i> General
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" id="api-tab" data-bs-toggle="tab" data-bs-target="#api" type="button">
                            <i class="fas fa-key"></i> API Settings
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" id="ai-tab" data-bs-toggle="tab" data-bs-target="#ai" type="button">
                            <i class="fas fa-robot"></i> AI Settings
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" id="printing-tab" data-bs-toggle="tab" data-bs-target="#printing" type="button">
                            <i class="fas fa-print"></i> Printing
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" id="pos-tab" data-bs-toggle="tab" data-bs-target="#pos" type="button">
                            <i class="fas fa-cash-register"></i> POS
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" id="advanced-tab" data-bs-toggle="tab" data-bs-target="#advanced" type="button">
                            <i class="fas fa-sliders-h"></i> Advanced
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" id="email-tab" data-bs-toggle="tab" data-bs-target="#email" type="button">
                            <i class="fas fa-envelope"></i> Email
                        </button>
                    </li>
                </ul>

                {{-- Tab Content --}}
                <div class="tab-content">
                    {{-- GENERAL TAB --}}
            <div class="tab-pane fade show active" id="general" role="tabpanel" aria-labelledby="general-tab">
                <div class="row">
                    {{-- Delivery & Collection Settings --}}
                    <div class="col-lg-6 mb-2">
                        <div class="card h-100">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-truck"></i> Delivery & Collection Settings
                                </h5>
                            </div>
                            <div class="card-body">
                                {{-- Route Optimization --}}
                                <div class="mb-2">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="enable_route_optimization" 
                                               name="enable_route_optimization" value="1" 
                                               {{ ($settings['enable_route_optimization'] ?? false) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="enable_route_optimization">
                                            <strong>Enable Route Optimization</strong>
                                        </label>
                                    </div>
                                    <div class="form-text">
                                        <i class="fas fa-route"></i> Show route planning and optimization features
                                    </div>
                                </div>

                                {{-- Delivery Time Slots --}}
                                <div class="mb-2">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="delivery_time_slots" 
                                               name="delivery_time_slots" value="1" 
                                               {{ ($settings['delivery_time_slots'] ?? false) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="delivery_time_slots">
                                            <strong>Delivery Time Slots</strong>
                                        </label>
                                    </div>
                                    <div class="form-text">
                                        <i class="fas fa-clock"></i> Enable specific delivery time slot selection
                                    </div>
                                </div>

                                {{-- Collection Reminder --}}
                                <div class="mb-2">
                                    <label for="collection_reminder_hours" class="form-label">
                                        <strong>Collection Reminder (Hours Before)</strong>
                                    </label>
                                    <select class="form-select" id="collection_reminder_hours" name="collection_reminder_hours">
                                        <option value="2" {{ ($settings['collection_reminder_hours'] ?? 24) == 2 ? 'selected' : '' }}>2 hours before</option>
                                        <option value="6" {{ ($settings['collection_reminder_hours'] ?? 24) == 6 ? 'selected' : '' }}>6 hours before</option>
                                        <option value="24" {{ ($settings['collection_reminder_hours'] ?? 24) == 24 ? 'selected' : '' }}>1 day before</option>
                                        <option value="48" {{ ($settings['collection_reminder_hours'] ?? 24) == 48 ? 'selected' : '' }}>2 days before</option>
                                        <option value="72" {{ ($settings['collection_reminder_hours'] ?? 24) == 72 ? 'selected' : '' }}>3 days before</option>
                                    </select>
                                    <div class="form-text">
                                        <i class="fas fa-bell"></i> When to send collection reminder emails/notifications
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {{-- Notification Settings --}}
                    <div class="col-lg-6 mb-2">
                        <div class="card h-100">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-envelope"></i> Notification Settings
                                </h5>
                            </div>
                            <div class="card-body">
                                {{-- Email Notifications --}}
                                <div class="mb-2">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="email_notifications" 
                                               name="email_notifications" value="1" 
                                               {{ ($settings['email_notifications'] ?? false) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="email_notifications">
                                            <strong>Email Notifications</strong>
                                        </label>
                                    </div>
                                    <div class="form-text">
                                        <i class="fas fa-mail-bulk"></i> Send automated email notifications to customers
                                    </div>
                                </div>

                                {{-- Future notification settings --}}
                                <div class="alert alert-light">
                                    <i class="fas fa-info-circle"></i>
                                    <strong>Coming Soon:</strong>
                                    <ul class="mb-0 mt-2">
                                        <li>SMS notifications</li>
                                        <li>Webhook integrations</li>
                                        <li>Slack/Discord notifications</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    {{-- System Information --}}
                    <div class="col-lg-12 mb-2">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-info-circle"></i> System Information
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <strong>Settings Storage:</strong>
                                        <span class="badge bg-success">Database (Encrypted)</span>
                                        <div class="form-text">
                                            Settings and API keys are stored encrypted in the database for security and persistence.
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <strong>Application Version:</strong><br>
                                        <span class="badge bg-primary">Admin Portal v2.0</span>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <strong>Environment:</strong><br>
                                        <span class="badge bg-info">{{ config('app.env') }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="api" role="tabpanel" aria-labelledby="api-tab">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> All API keys are securely encrypted before being stored in the database.
                </div>
                
                <div class="row">
                    {{-- FarmOS --}}
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-tractor"></i> FarmOS Integration</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-2">
                                    <label for="farmos_api_url" class="form-label">FarmOS URL</label>
                                    <input type="url" class="form-control" id="farmos_api_url" name="farmos_api_url" 
                                           value="{{ $settings['farmos_api_url'] ?? '' }}" placeholder="https://farm.example.com">
                                </div>
                                <div class="mb-3 api-key-field">
                                    <label for="farmos_username" class="form-label">Username</label>
                                    <input type="text" class="form-control" id="farmos_username" name="farmos_username" 
                                           value="{{ $settings['farmos_username'] ?? '' }}">
                                </div>
                                <div class="mb-3 api-key-field">
                                    <label for="farmos_password" class="form-label">Password</label>
                                    <input type="password" class="form-control" id="farmos_password" name="farmos_password" 
                                           value="{{ $settings['farmos_password'] ?? '' }}">
                                    <span class="toggle-password" data-target="#farmos_password">
                                        <i class="fas fa-eye"></i>
                                    </span>
                                </div>
                                <div class="mb-3 api-key-field">
                                    <label for="farmos_oauth_client_id" class="form-label">OAuth Client ID</label>
                                    <input type="password" class="form-control" id="farmos_oauth_client_id" name="farmos_oauth_client_id" 
                                           value="{{ $settings['farmos_oauth_client_id'] ?? '' }}">
                                    <span class="toggle-password" data-target="#farmos_oauth_client_id">
                                        <i class="fas fa-eye"></i>
                                    </span>
                                </div>
                                <div class="mb-3 api-key-field">
                                    <label for="farmos_oauth_client_secret" class="form-label">OAuth Client Secret</label>
                                    <input type="password" class="form-control" id="farmos_oauth_client_secret" name="farmos_oauth_client_secret" 
                                           value="{{ $settings['farmos_oauth_client_secret'] ?? '' }}">
                                    <span class="toggle-password" data-target="#farmos_oauth_client_secret">
                                        <i class="fas fa-eye"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    {{-- WooCommerce --}}
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fab fa-wordpress"></i> WooCommerce API</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-2">
                                    <label for="woocommerce_url" class="form-label">Store URL</label>
                                    <input type="url" class="form-control" id="woocommerce_url" name="woocommerce_url" 
                                           value="{{ $settings['woocommerce_url'] ?? '' }}" placeholder="https://shop.example.com">
                                </div>
                                <div class="mb-3 api-key-field">
                                    <label for="woocommerce_consumer_key" class="form-label">Consumer Key</label>
                                    <input type="password" class="form-control" id="woocommerce_consumer_key" name="woocommerce_consumer_key" 
                                           value="{{ $settings['woocommerce_consumer_key'] ?? '' }}">
                                    <span class="toggle-password" data-target="#woocommerce_consumer_key">
                                        <i class="fas fa-eye"></i>
                                    </span>
                                </div>
                                <div class="mb-3 api-key-field">
                                    <label for="woocommerce_consumer_secret" class="form-label">Consumer Secret</label>
                                    <input type="password" class="form-control" id="woocommerce_consumer_secret" name="woocommerce_consumer_secret" 
                                           value="{{ $settings['woocommerce_consumer_secret'] ?? '' }}">
                                    <span class="toggle-password" data-target="#woocommerce_consumer_secret">
                                        <i class="fas fa-eye"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    {{-- MWF API --}}
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-key"></i> MWF Shop Integration</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-2">
                                    <label for="mwf_api_base_url" class="form-label">API Base URL</label>
                                    <input type="url" class="form-control" id="mwf_api_base_url" name="mwf_api_base_url" 
                                           value="{{ $settings['mwf_api_base_url'] ?? '' }}">
                                </div>
                                <div class="mb-3 api-key-field">
                                    <label for="mwf_api_key" class="form-label">API Key</label>
                                    <input type="password" class="form-control" id="mwf_api_key" name="mwf_api_key" 
                                           value="{{ $settings['mwf_api_key'] ?? '' }}">
                                    <span class="toggle-password" data-target="#mwf_api_key">
                                        <i class="fas fa-eye"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    {{-- Google Maps --}}
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-map-marked-alt"></i> Google Maps API</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3 api-key-field">
                                    <label for="google_maps_api_key" class="form-label">API Key</label>
                                    <input type="password" class="form-control" id="google_maps_api_key" name="google_maps_api_key" 
                                           value="{{ $settings['google_maps_api_key'] ?? '' }}">
                                    <span class="toggle-password" data-target="#google_maps_api_key">
                                        <i class="fas fa-eye"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    {{-- Met Office APIs --}}
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-cloud-sun-rain"></i> Met Office APIs</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3 api-key-field">
                                    <label for="met_office_api_key" class="form-label">General API Key</label>
                                    <input type="password" class="form-control" id="met_office_api_key" name="met_office_api_key" 
                                           value="{{ $settings['met_office_api_key'] ?? '' }}">
                                    <span class="toggle-password" data-target="#met_office_api_key">
                                        <i class="fas fa-eye"></i>
                                    </span>
                                </div>
                                <div class="mb-3 api-key-field">
                                    <label for="met_office_land_observations_key" class="form-label">Land Observations Key</label>
                                    <input type="password" class="form-control" id="met_office_land_observations_key" name="met_office_land_observations_key" 
                                           value="{{ $settings['met_office_land_observations_key'] ?? '' }}">
                                    <span class="toggle-password" data-target="#met_office_land_observations_key">
                                        <i class="fas fa-eye"></i>
                                    </span>
                                </div>
                                <div class="mb-3 api-key-field">
                                    <label for="met_office_site_specific_key" class="form-label">Site Specific Forecast Key</label>
                                    <input type="password" class="form-control" id="met_office_site_specific_key" name="met_office_site_specific_key" 
                                           value="{{ $settings['met_office_site_specific_key'] ?? '' }}">
                                    <span class="toggle-password" data-target="#met_office_site_specific_key">
                                        <i class="fas fa-eye"></i>
                                    </span>
                                </div>
                                <div class="mb-3 api-key-field">
                                    <label for="met_office_atmospheric_key" class="form-label">Atmospheric Models Key</label>
                                    <input type="password" class="form-control" id="met_office_atmospheric_key" name="met_office_atmospheric_key" 
                                           value="{{ $settings['met_office_atmospheric_key'] ?? '' }}">
                                    <span class="toggle-password" data-target="#met_office_atmospheric_key">
                                        <i class="fas fa-eye"></i>
                                    </span>
                                </div>
                                <div class="mb-3 api-key-field">
                                    <label for="met_office_map_images_key" class="form-label">Map Images Key</label>
                                    <input type="password" class="form-control" id="met_office_map_images_key" name="met_office_map_images_key" 
                                           value="{{ $settings['met_office_map_images_key'] ?? '' }}">
                                    <span class="toggle-password" data-target="#met_office_map_images_key">
                                        <i class="fas fa-eye"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    {{-- OpenWeather --}}
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-cloud"></i> OpenWeather API</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3 api-key-field">
                                    <label for="openweather_api_key" class="form-label">API Key</label>
                                    <input type="password" class="form-control" id="openweather_api_key" name="openweather_api_key" 
                                           value="{{ $settings['openweather_api_key'] ?? '' }}">
                                    <span class="toggle-password" data-target="#openweather_api_key">
                                        <i class="fas fa-eye"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    {{-- AI APIs --}}
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-brain"></i> AI Service APIs</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3 api-key-field">
                                    <label for="huggingface_api_key" class="form-label">HuggingFace API Key</label>
                                    <input type="password" class="form-control" id="huggingface_api_key" name="huggingface_api_key" 
                                           value="{{ $settings['huggingface_api_key'] ?? '' }}">
                                    <span class="toggle-password" data-target="#huggingface_api_key">
                                        <i class="fas fa-eye"></i>
                                    </span>
                                </div>
                                <div class="mb-3 api-key-field">
                                    <label for="claude_api_key" class="form-label">Claude API Key</label>
                                    <input type="password" class="form-control" id="claude_api_key" name="claude_api_key" 
                                           value="{{ $settings['claude_api_key'] ?? '' }}">
                                    <span class="toggle-password" data-target="#claude_api_key">
                                        <i class="fas fa-eye"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    {{-- Stripe --}}
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fab fa-stripe"></i> Stripe Payment</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3 api-key-field">
                                    <label for="stripe_key" class="form-label">Publishable Key</label>
                                    <input type="password" class="form-control" id="stripe_key" name="stripe_key" 
                                           value="{{ $settings['stripe_key'] ?? '' }}">
                                    <span class="toggle-password" data-target="#stripe_key">
                                        <i class="fas fa-eye"></i>
                                    </span>
                                </div>
                                <div class="mb-3 api-key-field">
                                    <label for="stripe_secret" class="form-label">Secret Key</label>
                                    <input type="password" class="form-control" id="stripe_secret" name="stripe_secret" 
                                           value="{{ $settings['stripe_secret'] ?? '' }}">
                                    <span class="toggle-password" data-target="#stripe_secret">
                                        <i class="fas fa-eye"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    {{-- 3CX Phone System --}}
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-phone"></i> 3CX Phone System - CRM Integration</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-2">
                                    <label for="threecx_server_url" class="form-label">3CX Server URL</label>
                                    <input type="text" class="form-control" id="threecx_server_url" name="threecx_server_url" 
                                           value="{{ $settings['threecx_server_url'] ?? '' }}" 
                                           placeholder="https://pineappletelecoms2.3cx.uk:5001">
                                </div>
                                <div class="mb-2">
                                    <label for="threecx_extension" class="form-label">Extension Number</label>
                                    <input type="text" class="form-control" id="threecx_extension" name="threecx_extension" 
                                           value="{{ $settings['threecx_extension'] ?? '' }}" 
                                           placeholder="1036">
                                </div>
                                <div class="mb-2">
                                    <label for="threecx_did" class="form-label">DID Number (Public Phone)</label>
                                    <input type="text" class="form-control" id="threecx_did" name="threecx_did" 
                                           value="{{ $settings['threecx_did'] ?? '' }}" 
                                           placeholder="01522449610">
                                </div>
                                <div class="mb-2">
                                    <label for="threecx_mobile" class="form-label">Mobile Number</label>
                                    <input type="text" class="form-control" id="threecx_mobile" name="threecx_mobile" 
                                           value="{{ $settings['threecx_mobile'] ?? '' }}" 
                                           placeholder="07918526138">
                                </div>
                                <div class="mb-2">
                                    <label for="threecx_username" class="form-label">Username / Friendly Name</label>
                                    <input type="text" class="form-control" id="threecx_username" name="threecx_username" 
                                           value="{{ $settings['threecx_username'] ?? '' }}" 
                                           placeholder="martintaylor">
                                </div>
                                <div class="mb-2">
                                    <label for="threecx_crm_url" class="form-label">Open Contact URL</label>
                                    <input type="url" class="form-control" id="threecx_crm_url" name="threecx_crm_url" 
                                           value="{{ $settings['threecx_crm_url'] ?? '' }}" 
                                           placeholder="https://admin.middleworldfarms.org:8444/admin/crm/contact?phone=%CallerNumber%&name=%CallerDisplayName%">
                                    <small class="text-muted">
                                        <strong>Supported Variables:</strong><br>
                                        <code>%CallerNumber%</code> - Incoming caller ID<br>
                                        <code>%CallerDisplayName%</code> - Incoming display name
                                    </small>
                                </div>
                                <div class="mb-2">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="threecx_enable_tapi" name="threecx_enable_tapi" 
                                               value="1" {{ ($settings['threecx_enable_tapi'] ?? 0) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="threecx_enable_tapi">
                                            Enable TAPI Integration
                                        </label>
                                    </div>
                                    <small class="text-muted">TAPI (Telephony Application Programming Interface) enables desktop app integration. Only needed for legacy Windows CRM software.</small>
                                </div>
                                <div class="alert alert-info mb-0">
                                    <small>
                                        <strong>3CX Talk URL:</strong> {{ $settings['threecx_server_url'] ?? 'https://pineappletelecoms2.3cx.uk:5001' }}/{{ $settings['threecx_username'] ?? 'martintaylor' }}<br>
                                        <strong>3CX Meet URL:</strong> {{ $settings['threecx_server_url'] ?? 'https://pineappletelecoms2.3cx.uk:5001' }}/meet/{{ $settings['threecx_username'] ?? 'martintaylor' }}<br>
                                        <em class="text-muted mt-2 d-block">Configure in 3CX Management Console → Settings → Integration → CRM Integration → Set "Notify when" to "Ringing"</em>
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>

                    {{-- Ollama --}}
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-server"></i> Ollama (Local LLM)</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-2">
                                    <label for="ollama_url" class="form-label">Ollama Server URL</label>
                                    <input type="url" class="form-control" id="ollama_url" name="ollama_url" 
                                           value="{{ $settings['ollama_url'] ?? '' }}" placeholder="http://localhost:8005">
                                </div>
                                <div class="mb-2">
                                    <label for="ollama_chat_model" class="form-label">Default Chat Model</label>
                                    <input type="text" class="form-control" id="ollama_chat_model" name="ollama_chat_model" 
                                           value="{{ $settings['ollama_chat_model'] ?? '' }}" placeholder="phi3:latest">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="ai" role="tabpanel" aria-labelledby="ai-tab">
                <div class="alert alert-info">
                    <i class="fas fa-robot"></i> <strong>Local AI Models:</strong> Configure your Ollama instances for different AI-powered features across the farm management system.
                </div>
                
                <div class="row">
                    {{-- Primary Model (Phi 3 - Port 8005) --}}
                    <div class="col-md-6 mb-4">
                        <div class="card border-primary">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0"><i class="fas fa-rocket"></i> Primary Model (Phi 3)</h5>
                                <small>Fast responses for chatbot & succession planner</small>
                            </div>
                            <div class="card-body">
                                <div class="mb-2">
                                    <label for="ollama_primary_url" class="form-label">
                                        <strong>Server URL</strong>
                                    </label>
                                    <input type="url" class="form-control" id="ollama_primary_url" name="ollama_primary_url" 
                                           value="{{ $settings['ollama_primary_url'] ?? 'http://localhost:8005' }}" 
                                           placeholder="http://localhost:8005">
                                    <div class="form-text">
                                        <i class="fas fa-info-circle"></i> Primary Ollama server for quick responses
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <label for="ollama_primary_model" class="form-label">
                                        <strong>Model Name</strong>
                                    </label>
                                    <input type="text" class="form-control" id="ollama_primary_model" name="ollama_primary_model" 
                                           value="{{ $settings['ollama_primary_model'] ?? 'phi3:latest' }}" 
                                           placeholder="phi3:latest">
                                    <div class="form-text">
                                        <i class="fas fa-tag"></i> Used for: Chatbot, Succession Planner, General Queries
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <label for="ollama_primary_timeout" class="form-label">
                                        <strong>Timeout (seconds)</strong>
                                    </label>
                                    <input type="number" class="form-control" id="ollama_primary_timeout" name="ollama_primary_timeout" 
                                           value="{{ $settings['ollama_primary_timeout'] ?? '60' }}" 
                                           min="30" max="600" step="10">
                                    <div class="form-text">
                                        <i class="fas fa-clock"></i> Recommended: 60s for CPU-based processing
                                    </div>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="ollama_primary_enabled" name="ollama_primary_enabled" 
                                           value="1" {{ ($settings['ollama_primary_enabled'] ?? true) ? 'checked' : '' }}>
                                    <label class="form-check-label" for="ollama_primary_enabled">
                                        <strong>Enable Primary Model</strong>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    {{-- Processing Model (Mistral 7B - Port 8006) --}}
                    <div class="col-md-6 mb-4">
                        <div class="card border-info">
                            <div class="card-header bg-info text-white">
                                <h5 class="mb-0"><i class="fas fa-cogs"></i> Processing Model (Mistral 7B)</h5>
                                <small>Higher quality for background data processing</small>
                            </div>
                            <div class="card-body">
                                <div class="mb-2">
                                    <label for="ollama_processing_url" class="form-label">
                                        <strong>Server URL</strong>
                                    </label>
                                    <input type="url" class="form-control" id="ollama_processing_url" name="ollama_processing_url" 
                                           value="{{ $settings['ollama_processing_url'] ?? 'http://localhost:8006' }}" 
                                           placeholder="http://localhost:8006">
                                    <div class="form-text">
                                        <i class="fas fa-info-circle"></i> Slower but higher quality for batch jobs
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <label for="ollama_processing_model" class="form-label">
                                        <strong>Model Name</strong>
                                    </label>
                                    <input type="text" class="form-control" id="ollama_processing_model" name="ollama_processing_model" 
                                           value="{{ $settings['ollama_processing_model'] ?? 'mistral:7b' }}" 
                                           placeholder="mistral:7b">
                                    <div class="form-text">
                                        <i class="fas fa-tag"></i> Used for: Data Analysis, Crop Planning, Complex Reports
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <label for="ollama_processing_timeout" class="form-label">
                                        <strong>Timeout (seconds)</strong>
                                    </label>
                                    <input type="number" class="form-control" id="ollama_processing_timeout" name="ollama_processing_timeout" 
                                           value="{{ $settings['ollama_processing_timeout'] ?? '300' }}" 
                                           min="60" max="1200" step="30">
                                    <div class="form-text">
                                        <i class="fas fa-clock"></i> Recommended: 300s (5 min) - Slower but higher quality
                                    </div>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="ollama_processing_enabled" name="ollama_processing_enabled" 
                                           value="1" {{ ($settings['ollama_processing_enabled'] ?? true) ? 'checked' : '' }}>
                                    <label class="form-check-label" for="ollama_processing_enabled">
                                        <strong>Enable Processing Model</strong>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    {{-- RAG Model (Port 8007) --}}
                    <div class="col-md-6 mb-4">
                        <div class="card border-success">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0"><i class="fas fa-database"></i> RAG Model</h5>
                                <small>Retrieval-Augmented Generation for knowledge base</small>
                            </div>
                            <div class="card-body">
                                <div class="mb-2">
                                    <label for="ollama_rag_url" class="form-label">
                                        <strong>Server URL</strong>
                                    </label>
                                    <input type="url" class="form-control" id="ollama_rag_url" name="ollama_rag_url" 
                                           value="{{ $settings['ollama_rag_url'] ?? 'http://localhost:8007' }}" 
                                           placeholder="http://localhost:8007">
                                    <div class="form-text">
                                        <i class="fas fa-info-circle"></i> RAG server for context-aware responses
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <label for="ollama_rag_model" class="form-label">
                                        <strong>Model Name</strong>
                                    </label>
                                    <input type="text" class="form-control" id="ollama_rag_model" name="ollama_rag_model" 
                                           value="{{ $settings['ollama_rag_model'] ?? 'llama2:latest' }}" 
                                           placeholder="llama2:latest">
                                    <div class="form-text">
                                        <i class="fas fa-tag"></i> Used for: Knowledge Base Queries, Document Search
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <label for="ollama_rag_timeout" class="form-label">
                                        <strong>Timeout (seconds)</strong>
                                    </label>
                                    <input type="number" class="form-control" id="ollama_rag_timeout" name="ollama_rag_timeout" 
                                           value="{{ $settings['ollama_rag_timeout'] ?? '120' }}" 
                                           min="30" max="600" step="15">
                                    <div class="form-text">
                                        <i class="fas fa-clock"></i> Recommended: 120s (2 min) for document retrieval
                                    </div>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="ollama_rag_enabled" name="ollama_rag_enabled" 
                                           value="1" {{ ($settings['ollama_rag_enabled'] ?? true) ? 'checked' : '' }}>
                                    <label class="form-check-label" for="ollama_rag_enabled">
                                        <strong>Enable RAG Model</strong>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    {{-- AI Feature Toggles --}}
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-toggle-on"></i> AI Features</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-2">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="ai_chatbot_enabled" name="ai_chatbot_enabled" 
                                               value="1" {{ ($settings['ai_chatbot_enabled'] ?? true) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="ai_chatbot_enabled">
                                            <strong>AI Chatbot</strong>
                                        </label>
                                    </div>
                                    <div class="form-text">
                                        <i class="fas fa-comments"></i> Enable AI-powered chat assistant
                                    </div>
                                </div>

                                <div class="mb-2">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="ai_succession_planner" name="ai_succession_planner" 
                                               value="1" {{ ($settings['ai_succession_planner'] ?? true) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="ai_succession_planner">
                                            <strong>Succession Planner</strong>
                                        </label>
                                    </div>
                                    <div class="form-text">
                                        <i class="fas fa-calendar-alt"></i> AI-powered crop succession planning
                                    </div>
                                </div>

                                <div class="mb-2">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="ai_harvest_planning" name="ai_harvest_planning" 
                                               value="1" {{ ($settings['ai_harvest_planning'] ?? false) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="ai_harvest_planning">
                                            <strong>Harvest Planning</strong>
                                        </label>
                                    </div>
                                    <div class="form-text">
                                        <i class="fas fa-tractor"></i> AI-optimized harvest schedules
                                    </div>
                                </div>

                                <div class="mb-2">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="ai_crop_recommendations" 
                                               name="ai_crop_recommendations" value="1" {{ ($settings['ai_crop_recommendations'] ?? false) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="ai_crop_recommendations">
                                            <strong>Crop Recommendations</strong>
                                        </label>
                                    </div>
                                    <div class="form-text">
                                        <i class="fas fa-seedling"></i> AI suggestions for crop rotation and planting
                                    </div>
                                </div>

                                <div class="mb-2">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="ai_data_analysis" 
                                               name="ai_data_analysis" value="1" {{ ($settings['ai_data_analysis'] ?? false) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="ai_data_analysis">
                                            <strong>Automated Data Analysis</strong>
                                        </label>
                                    </div>
                                    <div class="form-text">
                                        <i class="fas fa-chart-line"></i> Use Mistral for background data processing
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {{-- RAG Ingestion Settings --}}
                    <div class="col-12 mb-4">
                        <div class="card border-warning">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="mb-0"><i class="fas fa-file-import"></i> RAG Knowledge Base Ingestion</h5>
                                <small>Configure automatic document ingestion for your RAG system</small>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-2">
                                            <label for="rag_ingestion_enabled" class="form-label">
                                                <strong>Auto Ingestion</strong>
                                            </label>
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="rag_ingestion_enabled" name="rag_ingestion_enabled" 
                                                       value="1" {{ ($settings['rag_ingestion_enabled'] ?? false) ? 'checked' : '' }}>
                                                <label class="form-check-label" for="rag_ingestion_enabled">
                                                    Enable automatic document ingestion
                                                </label>
                                            </div>
                                            <div class="form-text">
                                                <i class="fas fa-sync-alt"></i> Automatically process new documents added to watch folders
                                            </div>
                                        </div>

                                        <div class="mb-2">
                                            <label for="rag_watch_directory" class="form-label">
                                                <strong>Watch Directory</strong>
                                            </label>
                                            <input type="text" class="form-control" id="rag_watch_directory" name="rag_watch_directory" 
                                                   value="{{ $settings['rag_watch_directory'] ?? '/opt/sites/admin.middleworldfarms.org/storage/app/rag/documents' }}" 
                                                   placeholder="/path/to/documents">
                                            <div class="form-text">
                                                <i class="fas fa-folder"></i> Directory to monitor for new documents
                                            </div>
                                        </div>

                                        <div class="mb-2">
                                            <label for="rag_processed_directory" class="form-label">
                                                <strong>Processed Directory</strong>
                                            </label>
                                            <input type="text" class="form-control" id="rag_processed_directory" name="rag_processed_directory" 
                                                   value="{{ $settings['rag_processed_directory'] ?? '/opt/sites/admin.middleworldfarms.org/storage/app/rag/processed' }}" 
                                                   placeholder="/path/to/processed">
                                            <div class="form-text">
                                                <i class="fas fa-check-circle"></i> Where to move documents after processing
                                            </div>
                                        </div>

                                        <div class="mb-2">
                                            <label for="rag_chunk_size" class="form-label">
                                                <strong>Chunk Size (characters)</strong>
                                            </label>
                                            <input type="number" class="form-control" id="rag_chunk_size" name="rag_chunk_size" 
                                                   value="{{ $settings['rag_chunk_size'] ?? '1000' }}" 
                                                   min="500" max="4000" step="100">
                                            <div class="form-text">
                                                <i class="fas fa-cut"></i> Size of text chunks for embedding (default: 1000)
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="mb-2">
                                            <label for="rag_chunk_overlap" class="form-label">
                                                <strong>Chunk Overlap (characters)</strong>
                                            </label>
                                            <input type="number" class="form-control" id="rag_chunk_overlap" name="rag_chunk_overlap" 
                                                   value="{{ $settings['rag_chunk_overlap'] ?? '200' }}" 
                                                   min="0" max="500" step="50">
                                            <div class="form-text">
                                                <i class="fas fa-layer-group"></i> Overlap between chunks for context (default: 200)
                                            </div>
                                        </div>

                                        <div class="mb-2">
                                            <label for="rag_supported_formats" class="form-label">
                                                <strong>Supported File Formats</strong>
                                            </label>
                                            <input type="text" class="form-control" id="rag_supported_formats" name="rag_supported_formats" 
                                                   value="{{ $settings['rag_supported_formats'] ?? 'pdf,txt,docx,md' }}" 
                                                   placeholder="pdf,txt,docx,md">
                                            <div class="form-text">
                                                <i class="fas fa-file-alt"></i> Comma-separated list of file extensions
                                            </div>
                                        </div>

                                        <div class="mb-2">
                                            <label for="rag_embedding_model" class="form-label">
                                                <strong>Embedding Model</strong>
                                            </label>
                                            <select class="form-select" id="rag_embedding_model" name="rag_embedding_model">
                                                <option value="nomic-embed-text" {{ ($settings['rag_embedding_model'] ?? 'nomic-embed-text') == 'nomic-embed-text' ? 'selected' : '' }}>nomic-embed-text (Recommended)</option>
                                                <option value="all-minilm" {{ ($settings['rag_embedding_model'] ?? '') == 'all-minilm' ? 'selected' : '' }}>all-minilm</option>
                                                <option value="mxbai-embed-large" {{ ($settings['rag_embedding_model'] ?? '') == 'mxbai-embed-large' ? 'selected' : '' }}>mxbai-embed-large</option>
                                            </select>
                                            <div class="form-text">
                                                <i class="fas fa-brain"></i> Model used for generating embeddings
                                            </div>
                                        </div>

                                        <div class="mb-2">
                                            <label for="rag_ingestion_schedule" class="form-label">
                                                <strong>Ingestion Schedule</strong>
                                            </label>
                                            <select class="form-select" id="rag_ingestion_schedule" name="rag_ingestion_schedule">
                                                <option value="*/5 * * * *" {{ ($settings['rag_ingestion_schedule'] ?? '') == '*/5 * * * *' ? 'selected' : '' }}>Every 5 minutes</option>
                                                <option value="*/15 * * * *" {{ ($settings['rag_ingestion_schedule'] ?? '*/15 * * * *') == '*/15 * * * *' ? 'selected' : '' }}>Every 15 minutes (Recommended)</option>
                                                <option value="*/30 * * * *" {{ ($settings['rag_ingestion_schedule'] ?? '') == '*/30 * * * *' ? 'selected' : '' }}>Every 30 minutes</option>
                                                <option value="0 * * * *" {{ ($settings['rag_ingestion_schedule'] ?? '') == '0 * * * *' ? 'selected' : '' }}>Hourly</option>
                                                <option value="0 0 * * *" {{ ($settings['rag_ingestion_schedule'] ?? '') == '0 0 * * *' ? 'selected' : '' }}>Daily at midnight</option>
                                            </select>
                                            <div class="form-text">
                                                <i class="fas fa-clock"></i> How often to check for new documents
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="alert alert-info mt-3">
                                    <i class="fas fa-info-circle"></i> 
                                    <strong>How it works:</strong> Place documents in the watch directory. The system will automatically:
                                    <ol class="mb-0 mt-2">
                                        <li>Extract text from supported file formats</li>
                                        <li>Split content into overlapping chunks</li>
                                        <li>Generate embeddings using the selected model</li>
                                        <li>Store vectors in the PostgreSQL database</li>
                                        <li>Move processed files to the processed directory</li>
                                    </ol>
                                </div>

                                <hr class="my-4">

                                {{-- Drag and Drop Upload Zone --}}
                                <div class="mb-2">
                                    <label class="form-label">
                                        <strong><i class="fas fa-cloud-upload-alt"></i> Quick Upload Documents</strong>
                                    </label>
                                    <div id="rag-dropzone" class="border border-2 border-dashed rounded p-5 text-center" 
                                         style="background-color: #f8f9fa; cursor: pointer; transition: all 0.3s;">
                                        <i class="fas fa-file-upload fa-3x text-muted mb-3"></i>
                                        <h5 class="text-muted">Drag & Drop Files Here</h5>
                                        <p class="text-muted mb-3">or click to browse</p>
                                        <button type="button" class="btn btn-primary" id="browse-files-btn">
                                            <i class="fas fa-folder-open"></i> Browse Files
                                        </button>
                                        <input type="file" id="rag-file-input" multiple accept=".pdf,.txt,.docx,.doc,.md" 
                                               style="display: none;">
                                        <p class="text-muted mt-3 mb-0">
                                            <small>Supported: PDF, TXT, DOCX, MD • Max 10MB per file</small>
                                        </p>
                                    </div>
                                </div>

                                {{-- Upload Progress --}}
                                <div id="upload-progress" class="d-none">
                                    <div class="progress mb-2" style="height: 25px;">
                                        <div id="upload-progress-bar" class="progress-bar progress-bar-striped progress-bar-animated" 
                                             role="progressbar" style="width: 0%">0%</div>
                                    </div>
                                    <p id="upload-status" class="text-muted mb-0">
                                        <i class="fas fa-spinner fa-spin"></i> Uploading...
                                    </p>
                                </div>

                                {{-- Upload Results --}}
                                <div id="upload-results" class="mt-3"></div>

                                <hr class="my-4">

                                {{-- Document Status List --}}
                                <div class="mb-2">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <label class="form-label mb-0">
                                            <strong><i class="fas fa-list"></i> Document Status</strong>
                                        </label>
                                        <button type="button" class="btn btn-sm btn-outline-primary" id="refresh-docs-btn">
                                            <i class="fas fa-sync-alt"></i> Refresh
                                        </button>
                                    </div>

                                    <div class="card">
                                        <div class="card-header">
                                            <ul class="nav nav-tabs card-header-tabs" id="docs-tabs" role="tablist">
                                                <li class="nav-item" role="presentation">
                                                    <button class="nav-link active" id="pending-tab" data-bs-toggle="tab" 
                                                            data-bs-target="#pending-docs" type="button" role="tab">
                                                        <i class="fas fa-clock text-warning"></i> Pending 
                                                        <span class="badge bg-warning text-dark" id="pending-count">0</span>
                                                    </button>
                                                </li>
                                                <li class="nav-item" role="presentation">
                                                    <button class="nav-link" id="processed-tab" data-bs-toggle="tab" 
                                                            data-bs-target="#processed-docs" type="button" role="tab">
                                                        <i class="fas fa-check-circle text-success"></i> Processed 
                                                        <span class="badge bg-success" id="processed-count">0</span>
                                                    </button>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="card-body">
                                            <div class="tab-content" id="docs-tab-content">
                                                {{-- Pending Documents --}}
                                                <div class="tab-pane fade show active" id="pending-docs" role="tabpanel">
                                                    <div id="pending-docs-list">
                                                        <div class="text-center text-muted py-4">
                                                            <i class="fas fa-spinner fa-spin fa-2x"></i>
                                                            <p class="mt-2">Loading documents...</p>
                                                        </div>
                                                    </div>
                                                </div>

                                                {{-- Processed Documents --}}
                                                <div class="tab-pane fade" id="processed-docs" role="tabpanel">
                                                    <div id="processed-docs-list">
                                                        <div class="text-center text-muted py-4">
                                                            <i class="fas fa-spinner fa-spin fa-2x"></i>
                                                            <p class="mt-2">Loading documents...</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="printing" role="tabpanel" aria-labelledby="printing-tab">
                <div class="row">
                    <div class="col-md-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-print"></i> Print Settings</h5>
                            </div>
                            <div class="card-body">
                                {{-- Packing Slips Per Page --}}
                                <div class="mb-2">
                                    <label for="packing_slips_per_page" class="form-label">
                                        <strong>Packing Slips Per Page</strong>
                                        <small class="text-muted">(Perfect for paper guillotine cutting)</small>
                                    </label>
                                    <select class="form-select" id="packing_slips_per_page" name="packing_slips_per_page">
                                        <option value="1" {{ ($settings['packing_slips_per_page'] ?? 2) == 1 ? 'selected' : '' }}>1 per page (Full size)</option>
                                        <option value="2" {{ ($settings['packing_slips_per_page'] ?? 2) == 2 ? 'selected' : '' }}>2 per page (Half size)</option>
                                        <option value="4" {{ ($settings['packing_slips_per_page'] ?? 2) == 4 ? 'selected' : '' }}>4 per page (Quarter size)</option>
                                        <option value="6" {{ ($settings['packing_slips_per_page'] ?? 2) == 6 ? 'selected' : '' }}>6 per page (Compact)</option>
                                    </select>
                                    <div class="form-text">
                                        <i class="fas fa-cut"></i> Higher numbers = more slips per sheet to cut with guillotine
                                    </div>
                                </div>

                                {{-- Auto Print Mode --}}
                                <div class="mb-2">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="auto_print_mode" name="auto_print_mode" 
                                               value="1" {{ ($settings['auto_print_mode'] ?? false) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="auto_print_mode">
                                            <strong>Auto Print Mode</strong>
                                        </label>
                                    </div>
                                    <div class="form-text">
                                        <i class="fas fa-rocket"></i> Skip preview and send directly to printer queue (recommended for Epson printers)
                                    </div>
                                </div>

                                {{-- Paper Size --}}
                                <div class="mb-2">
                                    <label for="default_printer_paper_size" class="form-label">
                                        <strong>Default Paper Size</strong>
                                    </label>
                                    <select class="form-select" id="default_printer_paper_size" name="default_printer_paper_size">
                                        <option value="A4" {{ ($settings['default_printer_paper_size'] ?? 'A4') == 'A4' ? 'selected' : '' }}>A4 (210 × 297 mm)</option>
                                        <option value="Letter" {{ ($settings['default_printer_paper_size'] ?? 'A4') == 'Letter' ? 'selected' : '' }}>Letter (8.5 × 11 in)</option>
                                    </select>
                                </div>

                                {{-- Company Logo --}}
                                <div class="mb-2">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="print_company_logo" 
                                               name="print_company_logo" value="1" 
                                               {{ ($settings['print_company_logo'] ?? false) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="print_company_logo">
                                            <strong>Include Company Logo</strong>
                                        </label>
                                    </div>
                                    <div class="form-text">
                                        <i class="fas fa-image"></i> Print farm logo on packing slips
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 mb-4">
                        <div class="card h-100 bg-light">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-lightbulb"></i> Printing Tips</h5>
                            </div>
                            <div class="card-body">
                                <h6><i class="fas fa-check-circle text-success"></i> Best Practices:</h6>
                                <ul class="mb-2">
                                    <li><strong>2 per page</strong> - Best for standard A4/Letter with guillotine cutting</li>
                                    <li><strong>4 per page</strong> - Ideal for smaller box labels</li>
                                    <li><strong>Auto Print</strong> - Works best with dedicated thermal/Epson printers</li>
                                </ul>

                                <h6><i class="fas fa-info-circle text-primary"></i> Paper Guillotine:</h6>
                                <p class="small mb-0">
                                    Multiple slips per page are designed to align perfectly with paper guillotine cutting guides,
                                    allowing you to quickly cut multiple packing slips at once without measuring.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div>

            <div class="tab-pane fade" id="advanced" role="tabpanel" aria-labelledby="advanced-tab">
                <div class="row">
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">Advanced Settings</h5>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-warning">
                                    <i class="fas fa-exclamation-triangle"></i> 
                                    These settings should only be modified if you know what you are doing.
                                </div>

                                <div class="mb-2">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="debug_mode" name="debug_mode" 
                                               value="1" {{ ($settings['debug_mode'] ?? false) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="debug_mode">
                                            <strong>Debug Mode</strong>
                                        </label>
                                    </div>
                                    <div class="form-text">
                                        <i class="fas fa-bug"></i> Enable detailed error reporting and logging
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="pos" role="tabpanel" aria-labelledby="pos-tab">
                <div class="row">
                    <div class="col-lg-6 mb-2">
                        <div class="card h-100">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-credit-card"></i> Payment Methods
                                </h5>
                            </div>
                            <div class="card-body">
                                <p class="text-muted mb-2">
                                    Configure which payment methods are available at the POS terminal
                                </p>

                                {{-- Cash Payment --}}
                                <div class="mb-2">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="pos_payment_cash" 
                                               name="pos_payment_cash" value="1" 
                                               {{ (old('pos_payment_cash', $settings['pos_payment_cash'] ?? true)) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="pos_payment_cash">
                                            <i class="fas fa-money-bill-wave text-success"></i> Cash Payments
                                        </label>
                                    </div>
                                    <small class="text-muted ms-4">Accept cash payments at the POS terminal</small>
                                </div>

                                {{-- Card Payment --}}
                                <div class="mb-2">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="pos_payment_card" 
                                               name="pos_payment_card" value="1" 
                                               {{ (old('pos_payment_card', $settings['pos_payment_card'] ?? true)) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="pos_payment_card">
                                            <i class="fas fa-credit-card text-primary"></i> Card Payments
                                        </label>
                                    </div>
                                    <small class="text-muted ms-4">Accept card payments via mobile payment apps</small>
                                </div>

                                {{-- Stripe Terminal --}}
                                <div class="mb-3 ps-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="pos_payment_stripe" 
                                               name="pos_payment_stripe" value="1" 
                                               {{ (old('pos_payment_stripe', $settings['pos_payment_stripe'] ?? false)) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="pos_payment_stripe">
                                            <i class="fab fa-stripe text-info"></i> Stripe Terminal
                                        </label>
                                    </div>
                                    <small class="text-muted ms-4">Use Stripe Terminal app for card payments</small>
                                </div>

                                {{-- WooCommerce Payments --}}
                                <div class="mb-3 ps-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="pos_payment_woocommerce" 
                                               name="pos_payment_woocommerce" value="1" 
                                               {{ (old('pos_payment_woocommerce', $settings['pos_payment_woocommerce'] ?? false)) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="pos_payment_woocommerce">
                                            <i class="fab fa-wordpress text-primary"></i> WooCommerce Payments
                                        </label>
                                    </div>
                                    <small class="text-muted ms-4">Use WooCommerce mobile app for payments</small>
                                </div>

                                {{-- Square --}}
                                <div class="mb-3 ps-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="pos_payment_square" 
                                               name="pos_payment_square" value="1" 
                                               {{ (old('pos_payment_square', $settings['pos_payment_square'] ?? false)) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="pos_payment_square">
                                            <i class="fas fa-square text-dark"></i> Square
                                        </label>
                                    </div>
                                    <small class="text-muted ms-4">Use Square app for card payments</small>
                                </div>

                                {{-- SumUp --}}
                                <div class="mb-3 ps-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="pos_payment_sumup" 
                                               name="pos_payment_sumup" value="1" 
                                               {{ (old('pos_payment_sumup', $settings['pos_payment_sumup'] ?? false)) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="pos_payment_sumup">
                                            <i class="fas fa-calculator text-success"></i> SumUp
                                        </label>
                                    </div>
                                    <small class="text-muted ms-4">Use SumUp app for card payments</small>
                                </div>

                                {{-- Bank Transfer --}}
                                <div class="mb-2">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="pos_payment_bank_transfer" 
                                               name="pos_payment_bank_transfer" value="1" 
                                               {{ (old('pos_payment_bank_transfer', $settings['pos_payment_bank_transfer'] ?? false)) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="pos_payment_bank_transfer">
                                            <i class="fas fa-university text-secondary"></i> Bank Transfer
                                        </label>
                                    </div>
                                    <small class="text-muted ms-4">Accept bank transfer payments</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6 mb-2">
                        <div class="card h-100">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-cog"></i> POS Settings
                                </h5>
                            </div>
                            <div class="card-body">
                                {{-- Receipt Printing --}}
                                <div class="mb-2">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="pos_auto_print_receipt" 
                                               name="pos_auto_print_receipt" value="1" 
                                               {{ (old('pos_auto_print_receipt', $settings['pos_auto_print_receipt'] ?? false)) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="pos_auto_print_receipt">
                                            <i class="fas fa-receipt"></i> Auto-print receipts
                                        </label>
                                    </div>
                                    <small class="text-muted ms-4">Automatically print receipt after each sale</small>
                                </div>

                                {{-- Receipt Email --}}
                                <div class="mb-2">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="pos_email_receipt" 
                                               name="pos_email_receipt" value="1" 
                                               {{ (old('pos_email_receipt', $settings['pos_email_receipt'] ?? false)) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="pos_email_receipt">
                                            <i class="fas fa-envelope"></i> Offer email receipts
                                        </label>
                                    </div>
                                    <small class="text-muted ms-4">Allow customers to receive receipts by email</small>
                                </div>

                                {{-- Tax Rate --}}
                                <div class="mb-2">
                                    <label for="pos_tax_rate" class="form-label">
                                        <i class="fas fa-percentage"></i> Default Tax Rate
                                    </label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="pos_tax_rate" 
                                               name="pos_tax_rate" 
                                               value="{{ old('pos_tax_rate', $settings['pos_tax_rate'] ?? '0') }}" 
                                               step="0.01" min="0" max="100">
                                        <span class="input-group-text">%</span>
                                    </div>
                                    <small class="text-muted">Default tax rate for products (0 for no tax)</small>
                                </div>

                                {{-- Currency Symbol --}}
                                <div class="mb-2">
                                    <label for="pos_currency_symbol" class="form-label">
                                        <i class="fas fa-pound-sign"></i> Currency Symbol
                                    </label>
                                    <input type="text" class="form-control" id="pos_currency_symbol" 
                                           name="pos_currency_symbol" 
                                           value="{{ old('pos_currency_symbol', $settings['pos_currency_symbol'] ?? '£') }}" 
                                           maxlength="5">
                                    <small class="text-muted">Symbol to display for prices (£, $, €, etc.)</small>
                                </div>

                                {{-- Low Stock Alert --}}
                                <div class="mb-2">
                                    <label for="pos_low_stock_threshold" class="form-label">
                                        <i class="fas fa-exclamation-triangle"></i> Low Stock Alert Threshold
                                    </label>
                                    <input type="number" class="form-control" id="pos_low_stock_threshold" 
                                           name="pos_low_stock_threshold" 
                                           value="{{ old('pos_low_stock_threshold', $settings['pos_low_stock_threshold'] ?? '5') }}" 
                                           min="0">
                                    <small class="text-muted">Alert when product stock falls below this number</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    {{-- Scale Integration Settings --}}
                    <div class="col-lg-12 mb-2">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-balance-scale"></i> Scale Integration
                                </h5>
                            </div>
                            <div class="card-body">
                                <p class="text-muted mb-4">
                                    Configure how your POS system connects to digital scales for weighing products. Choose the integration method that matches your hardware setup.
                                </p>

                                <div class="row">
                                    {{-- Integration Type --}}
                                    <div class="col-lg-6 mb-3">
                                        <label for="pos_scale_integration" class="form-label">
                                            <i class="fas fa-plug"></i> Scale Integration Type
                                        </label>
                                        <select class="form-select" id="pos_scale_integration" name="pos_scale_integration">
                                            <option value="manual" {{ old('pos_scale_integration', $settings['pos_scale_integration'] ?? 'manual') == 'manual' ? 'selected' : '' }}>
                                                Manual Entry (Default)
                                            </option>
                                            <option value="web_serial" {{ old('pos_scale_integration', $settings['pos_scale_integration'] ?? 'manual') == 'web_serial' ? 'selected' : '' }}>
                                                Web Serial API (USB Scales)
                                            </option>
                                            <option value="web_bluetooth" {{ old('pos_scale_integration', $settings['pos_scale_integration'] ?? 'manual') == 'web_bluetooth' ? 'selected' : '' }}>
                                                Web Bluetooth (BLE Scales)
                                            </option>
                                            <option value="websocket" {{ old('pos_scale_integration', $settings['pos_scale_integration'] ?? 'manual') == 'websocket' ? 'selected' : '' }}>
                                                WebSocket Service (Advanced)
                                            </option>
                                        </select>
                                        <small class="text-muted">
                                            Choose the method based on your scale type and device compatibility
                                        </small>
                                    </div>

                                    {{-- Auto-populate Weight --}}
                                    <div class="col-lg-6 mb-3">
                                        <label class="form-label d-block">
                                            <i class="fas fa-magic"></i> Auto-populate Settings
                                        </label>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="pos_scale_auto_populate" 
                                                   name="pos_scale_auto_populate" value="1" 
                                                   {{ (old('pos_scale_auto_populate', $settings['pos_scale_auto_populate'] ?? false)) ? 'checked' : '' }}>
                                            <label class="form-check-label" for="pos_scale_auto_populate">
                                                Auto-populate weight from scale
                                            </label>
                                        </div>
                                        <small class="text-muted d-block mt-1">
                                            Automatically fill weight field when scale reading is stable
                                        </small>

                                        <div class="form-check form-switch mt-2">
                                            <input class="form-check-input" type="checkbox" id="pos_scale_auto_connect" 
                                                   name="pos_scale_auto_connect" value="1" 
                                                   {{ (old('pos_scale_auto_connect', $settings['pos_scale_auto_connect'] ?? false)) ? 'checked' : '' }}>
                                            <label class="form-check-label" for="pos_scale_auto_connect">
                                                Auto-connect to scale on POS load
                                            </label>
                                        </div>
                                        <small class="text-muted d-block mt-1">
                                            Automatically connect to the last used scale when opening POS
                                        </small>
                                    </div>
                                </div>

                                {{-- Web Serial (USB) Settings --}}
                                <div id="web-serial-settings" class="scale-settings-section mt-2" style="display: none;">
                                    <h6 class="border-bottom pb-2 mb-2">
                                        <i class="fas fa-usb"></i> USB Scale Settings (Web Serial API)
                                    </h6>
                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle"></i>
                                        <strong>Requirements:</strong> Chrome or Edge browser on Windows, Mac, or Linux. 
                                        Works with most USB retail scales. <strong>Note:</strong> Not supported on iPad/iOS.
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-6 mb-3">
                                            <label for="pos_scale_protocol" class="form-label">Scale Protocol</label>
                                            <select class="form-select" id="pos_scale_protocol" name="pos_scale_protocol">
                                                <option value="generic" {{ old('pos_scale_protocol', $settings['pos_scale_protocol'] ?? 'generic') == 'generic' ? 'selected' : '' }}>
                                                    Generic/Auto-detect
                                                </option>
                                                <option value="mettler_toledo" {{ old('pos_scale_protocol', $settings['pos_scale_protocol'] ?? 'generic') == 'mettler_toledo' ? 'selected' : '' }}>
                                                    Mettler Toledo
                                                </option>
                                                <option value="fairbanks" {{ old('pos_scale_protocol', $settings['pos_scale_protocol'] ?? 'generic') == 'fairbanks' ? 'selected' : '' }}>
                                                    Fairbanks
                                                </option>
                                                <option value="ohaus" {{ old('pos_scale_protocol', $settings['pos_scale_protocol'] ?? 'generic') == 'ohaus' ? 'selected' : '' }}>
                                                    Ohaus
                                                </option>
                                                <option value="avery_weigh_tronix" {{ old('pos_scale_protocol', $settings['pos_scale_protocol'] ?? 'generic') == 'avery_weigh_tronix' ? 'selected' : '' }}>
                                                    Avery Weigh-Tronix
                                                </option>
                                                <option value="cas" {{ old('pos_scale_protocol', $settings['pos_scale_protocol'] ?? 'generic') == 'cas' ? 'selected' : '' }}>
                                                    CAS
                                                </option>
                                            </select>
                                            <small class="text-muted">Select your scale manufacturer or use auto-detect</small>
                                        </div>
                                        <div class="col-lg-6 mb-3">
                                            <label for="pos_scale_baud_rate" class="form-label">Baud Rate</label>
                                            <select class="form-select" id="pos_scale_baud_rate" name="pos_scale_baud_rate">
                                                <option value="9600" {{ old('pos_scale_baud_rate', $settings['pos_scale_baud_rate'] ?? '9600') == '9600' ? 'selected' : '' }}>9600</option>
                                                <option value="4800" {{ old('pos_scale_baud_rate', $settings['pos_scale_baud_rate'] ?? '9600') == '4800' ? 'selected' : '' }}>4800</option>
                                                <option value="19200" {{ old('pos_scale_baud_rate', $settings['pos_scale_baud_rate'] ?? '9600') == '19200' ? 'selected' : '' }}>19200</option>
                                                <option value="38400" {{ old('pos_scale_baud_rate', $settings['pos_scale_baud_rate'] ?? '9600') == '38400' ? 'selected' : '' }}>38400</option>
                                            </select>
                                            <small class="text-muted">Most scales use 9600 (check your scale manual)</small>
                                        </div>
                                    </div>
                                </div>

                                {{-- Web Bluetooth Settings --}}
                                <div id="web-bluetooth-settings" class="scale-settings-section mt-2" style="display: none;">
                                    <h6 class="border-bottom pb-2 mb-2">
                                        <i class="fab fa-bluetooth"></i> Bluetooth Scale Settings (BLE)
                                    </h6>
                                    <div class="alert alert-warning">
                                        <i class="fas fa-exclamation-triangle"></i>
                                        <strong>Limited Support:</strong> Web Bluetooth has limited browser support. 
                                        Works best on Chrome/Edge (desktop) and Chrome on Android. 
                                        <strong>Not widely supported on iOS/iPadOS.</strong>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12 mb-3">
                                            <label for="pos_scale_bluetooth_service" class="form-label">Bluetooth Service UUID</label>
                                            <input type="text" class="form-control" id="pos_scale_bluetooth_service" 
                                                   name="pos_scale_bluetooth_service" 
                                                   value="{{ old('pos_scale_bluetooth_service', $settings['pos_scale_bluetooth_service'] ?? '') }}" 
                                                   placeholder="e.g., 0000181d-0000-1000-8000-00805f9b34fb">
                                            <small class="text-muted">Enter the Bluetooth service UUID for your scale (check scale documentation)</small>
                                        </div>
                                    </div>
                                </div>

                                {{-- WebSocket Settings --}}
                                <div id="websocket-settings" class="scale-settings-section mt-2" style="display: none;">
                                    <h6 class="border-bottom pb-2 mb-2">
                                        <i class="fas fa-server"></i> WebSocket Service Settings (Advanced)
                                    </h6>
                                    <div class="alert alert-success">
                                        <i class="fas fa-check-circle"></i>
                                        <strong>Most Flexible:</strong> Run a local service (Node.js/Python) on your POS device. 
                                        Works with any scale type, any OS, and all browsers. Ideal for production setups.
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-8 mb-3">
                                            <label for="pos_scale_websocket_url" class="form-label">WebSocket Server URL</label>
                                            <input type="text" class="form-control" id="pos_scale_websocket_url" 
                                                   name="pos_scale_websocket_url" 
                                                   value="{{ old('pos_scale_websocket_url', $settings['pos_scale_websocket_url'] ?? 'ws://localhost:8765') }}" 
                                                   placeholder="ws://localhost:8765">
                                            <small class="text-muted">
                                                URL of your local scale reader service (default: ws://localhost:8765)
                                            </small>
                                        </div>
                                        <div class="col-lg-4 mb-3">
                                            <label for="pos_scale_reconnect_interval" class="form-label">Reconnect Interval (ms)</label>
                                            <input type="number" class="form-control" id="pos_scale_reconnect_interval" 
                                                   name="pos_scale_reconnect_interval" 
                                                   value="{{ old('pos_scale_reconnect_interval', $settings['pos_scale_reconnect_interval'] ?? '5000') }}" 
                                                   min="1000" step="1000">
                                            <small class="text-muted">How often to retry connection</small>
                                        </div>
                                    </div>
                                    <div class="alert alert-info mb-0">
                                        <i class="fas fa-book"></i>
                                        <strong>Setup Guide:</strong> See documentation for example Node.js and Python scale reader services.
                                    </div>
                                </div>

                                {{-- Manual Entry Info --}}
                                <div id="manual-entry-info" class="scale-settings-section mt-2">
                                    <div class="alert alert-secondary mb-0">
                                        <i class="fas fa-keyboard"></i>
                                        <strong>Manual Entry Mode:</strong> Users will manually enter weight values using the on-screen dialog. 
                                        No automatic scale integration. This is the most compatible option for all devices.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {{-- Card Reader Integration Settings --}}
                    <div class="col-lg-12 mb-2">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-credit-card"></i> Card Reader Integration
                                </h5>
                            </div>
                            <div class="card-body">
                                <p class="text-muted mb-4">
                                    Configure card payment terminal integration for your POS system. Choose from manual entry, mobile card readers, or integrated payment terminals.
                                </p>

                                <div class="row">
                                    {{-- Card Reader Type --}}
                                    <div class="col-lg-6 mb-3">
                                        <label for="pos_card_reader_type" class="form-label">
                                            <i class="fas fa-terminal"></i> Card Reader Type
                                        </label>
                                        <select class="form-select" id="pos_card_reader_type" name="pos_card_reader_type">
                                            <option value="manual" {{ old('pos_card_reader_type', $settings['pos_card_reader_type'] ?? 'manual') == 'manual' ? 'selected' : '' }}>
                                                Manual Entry (No Reader)
                                            </option>
                                            <option value="stripe_terminal" {{ old('pos_card_reader_type', $settings['pos_card_reader_type'] ?? 'manual') == 'stripe_terminal' ? 'selected' : '' }}>
                                                Stripe Terminal (BBPOS WisePad, Verifone)
                                            </option>
                                            <option value="square_reader" {{ old('pos_card_reader_type', $settings['pos_card_reader_type'] ?? 'manual') == 'square_reader' ? 'selected' : '' }}>
                                                Square Reader (Contactless & Chip)
                                            </option>
                                            <option value="sumup" {{ old('pos_card_reader_type', $settings['pos_card_reader_type'] ?? 'manual') == 'sumup' ? 'selected' : '' }}>
                                                SumUp Card Reader
                                            </option>
                                            <option value="paypal_here" {{ old('pos_card_reader_type', $settings['pos_card_reader_type'] ?? 'manual') == 'paypal_here' ? 'selected' : '' }}>
                                                PayPal Here Card Reader
                                            </option>
                                            <option value="web_nfc" {{ old('pos_card_reader_type', $settings['pos_card_reader_type'] ?? 'manual') == 'web_nfc' ? 'selected' : '' }}>
                                                Web NFC (Contactless Only - Android)
                                            </option>
                                            <option value="web_usb" {{ old('pos_card_reader_type', $settings['pos_card_reader_type'] ?? 'manual') == 'web_usb' ? 'selected' : '' }}>
                                                Web USB (Generic USB Readers)
                                            </option>
                                            <option value="websocket_terminal" {{ old('pos_card_reader_type', $settings['pos_card_reader_type'] ?? 'manual') == 'websocket_terminal' ? 'selected' : '' }}>
                                                WebSocket Service (Backend Integration)
                                            </option>
                                        </select>
                                        <small class="text-muted">
                                            Choose your card payment method
                                        </small>
                                    </div>

                                    {{-- Connection Method --}}
                                    <div class="col-lg-6 mb-3">
                                        <label for="pos_card_reader_connection" class="form-label">
                                            <i class="fas fa-plug"></i> Connection Method
                                        </label>
                                        <select class="form-select" id="pos_card_reader_connection" name="pos_card_reader_connection">
                                            <option value="bluetooth" {{ old('pos_card_reader_connection', $settings['pos_card_reader_connection'] ?? 'bluetooth') == 'bluetooth' ? 'selected' : '' }}>
                                                Bluetooth
                                            </option>
                                            <option value="usb" {{ old('pos_card_reader_connection', $settings['pos_card_reader_connection'] ?? 'bluetooth') == 'usb' ? 'selected' : '' }}>
                                                USB
                                            </option>
                                            <option value="network" {{ old('pos_card_reader_connection', $settings['pos_card_reader_connection'] ?? 'bluetooth') == 'network' ? 'selected' : '' }}>
                                                Network (IP Address)
                                            </option>
                                            <option value="mobile_app" {{ old('pos_card_reader_connection', $settings['pos_card_reader_connection'] ?? 'bluetooth') == 'mobile_app' ? 'selected' : '' }}>
                                                Mobile App Integration
                                            </option>
                                        </select>
                                        <small class="text-muted">
                                            How the reader connects to your device
                                        </small>
                                    </div>
                                </div>

                                {{-- Stripe Terminal Settings --}}
                                <div id="stripe-terminal-settings" class="card-reader-section" style="display: none;">
                                    <div class="border-top pt-2">
                                        <h6 class="mb-2"><i class="fab fa-stripe text-info"></i> Stripe Terminal Configuration</h6>
                                        <div class="alert alert-warning mb-2">
                                            <i class="fas fa-exclamation-triangle"></i>
                                            <strong>Note:</strong> Configure your Stripe API keys in the <strong>API Settings</strong> tab first.
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-6 mb-2">
                                                <label for="pos_stripe_publishable_key" class="form-label">Stripe Publishable Key</label>
                                                <input type="text" class="form-control" id="pos_stripe_publishable_key" 
                                                       name="pos_stripe_publishable_key" 
                                                       value="{{ old('pos_stripe_publishable_key', $settings['pos_stripe_publishable_key'] ?? '') }}"
                                                       placeholder="pk_live_...">
                                                <small class="text-muted">Your Stripe publishable key (starts with pk_) - for frontend Stripe.js</small>
                                            </div>
                                            <div class="col-lg-6 mb-2">
                                                <label for="pos_currency" class="form-label">Currency Code</label>
                                                <input type="text" class="form-control" id="pos_currency" 
                                                       name="pos_currency" 
                                                       value="{{ old('pos_currency', $settings['pos_currency'] ?? 'gbp') }}"
                                                       placeholder="gbp" maxlength="3">
                                                <small class="text-muted">Currency code (gbp, usd, eur, etc.)</small>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-6 mb-2">
                                                <label for="pos_stripe_location_id" class="form-label">Location ID (Optional)</label>
                                                <input type="text" class="form-control" id="pos_stripe_location_id" 
                                                       name="pos_stripe_location_id" 
                                                       value="{{ old('pos_stripe_location_id', $settings['pos_stripe_location_id'] ?? '') }}"
                                                       placeholder="tml_...">
                                                <small class="text-muted">For Stripe Terminal hardware readers only (BBPOS WisePad, Verifone P400)</small>
                                            </div>
                                        </div>
                                        <div class="alert alert-info mb-0">
                                            <i class="fas fa-info-circle"></i>
                                            <strong>Stripe Payment Intents:</strong> Works with card form on screen (all devices), Tap to Pay (iPhone XS+/iPad), or physical Stripe Terminal readers
                                        </div>
                                    </div>
                                </div>

                                {{-- Square Settings --}}
                                <div id="square-reader-settings" class="card-reader-section mt-2" style="display: none;">
                                    <div class="border-top pt-2">
                                        <h6 class="mb-2"><i class="fas fa-square text-dark"></i> Square Reader Configuration</h6>
                                        <div class="row">
                                            <div class="col-lg-12 mb-3">
                                                <label for="pos_square_app_id" class="form-label">Square Application ID</label>
                                                <input type="text" class="form-control" id="pos_square_app_id" 
                                                       name="pos_square_app_id" 
                                                       value="{{ old('pos_square_app_id', $settings['pos_square_app_id'] ?? '') }}"
                                                       placeholder="sq0idp-...">
                                            </div>
                                        </div>
                                        <div class="alert alert-info mb-0">
                                            <i class="fas fa-info-circle"></i>
                                            Use Square Point of Sale app on mobile device. Transactions will open Square app for payment processing.
                                        </div>
                                    </div>
                                </div>

                                {{-- Web NFC Settings --}}
                                <div id="web-nfc-settings" class="card-reader-section mt-2" style="display: none;">
                                    <div class="border-top pt-2">
                                        <div class="alert alert-warning mb-0">
                                            <i class="fas fa-exclamation-triangle"></i>
                                            <strong>Web NFC (Experimental):</strong> Only works on Android Chrome for contactless (tap-to-pay) cards. 
                                            Not supported on iOS/iPadOS. Requires payment processor backend integration.
                                        </div>
                                    </div>
                                </div>

                                {{-- WebSocket Terminal Settings --}}
                                <div id="websocket-terminal-settings" class="card-reader-section mt-2" style="display: none;">
                                    <div class="border-top pt-2">
                                        <h6 class="mb-2"><i class="fas fa-server"></i> WebSocket Payment Terminal</h6>
                                        <div class="row">
                                            <div class="col-lg-12 mb-3">
                                                <label for="pos_card_websocket_url" class="form-label">WebSocket Server URL</label>
                                                <input type="text" class="form-control" id="pos_card_websocket_url" 
                                                       name="pos_card_websocket_url" 
                                                       value="{{ old('pos_card_websocket_url', $settings['pos_card_websocket_url'] ?? 'ws://localhost:8766') }}"
                                                       placeholder="ws://localhost:8766">
                                                <small class="text-muted">URL of your payment terminal service</small>
                                            </div>
                                        </div>
                                        <div class="alert alert-info mb-0">
                                            <i class="fas fa-info-circle"></i>
                                            Run a backend service that communicates with your payment terminal (PIN pad, etc.)
                                        </div>
                                    </div>
                                </div>

                                {{-- Manual Entry Info --}}
                                <div id="manual-card-entry" class="card-reader-section mt-2">
                                    <div class="alert alert-secondary mb-0">
                                        <i class="fas fa-keyboard"></i>
                                        <strong>Manual Entry:</strong> Mark payments as "Card" payment type manually. 
                                        Use separate mobile card reader apps (Stripe Terminal, Square, SumUp) for actual payment processing.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {{-- Receipt Printer Integration Settings --}}
                    <div class="col-lg-12 mb-2">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-print"></i> Receipt Printer Integration
                                </h5>
                            </div>
                            <div class="card-body">
                                <p class="text-muted mb-4">
                                    Configure receipt printer for automatic or manual printing. Supports thermal printers, regular printers, and browser printing.
                                </p>

                                <div class="row">
                                    {{-- Printer Type --}}
                                    <div class="col-lg-6 mb-3">
                                        <label for="pos_printer_type" class="form-label">
                                            <i class="fas fa-print"></i> Printer Type
                                        </label>
                                        <select class="form-select" id="pos_printer_type" name="pos_printer_type">
                                            <option value="browser" {{ old('pos_printer_type', $settings['pos_printer_type'] ?? 'browser') == 'browser' ? 'selected' : '' }}>
                                                Browser Print (Default)
                                            </option>
                                            <option value="star_micronics" {{ old('pos_printer_type', $settings['pos_printer_type'] ?? 'browser') == 'star_micronics' ? 'selected' : '' }}>
                                                Star Micronics (CloudPRNT/Web)
                                            </option>
                                            <option value="epson" {{ old('pos_printer_type', $settings['pos_printer_type'] ?? 'browser') == 'epson' ? 'selected' : '' }}>
                                                Epson TM-Series (ePOS)
                                            </option>
                                            <option value="web_usb_thermal" {{ old('pos_printer_type', $settings['pos_printer_type'] ?? 'browser') == 'web_usb_thermal' ? 'selected' : '' }}>
                                                Web USB Thermal Printer
                                            </option>
                                            <option value="web_bluetooth_thermal" {{ old('pos_printer_type', $settings['pos_printer_type'] ?? 'browser') == 'web_bluetooth_thermal' ? 'selected' : '' }}>
                                                Bluetooth Thermal Printer
                                            </option>
                                            <option value="network_printer" {{ old('pos_printer_type', $settings['pos_printer_type'] ?? 'browser') == 'network_printer' ? 'selected' : '' }}>
                                                Network Printer (IP Address)
                                            </option>
                                            <option value="websocket_printer" {{ old('pos_printer_type', $settings['pos_printer_type'] ?? 'browser') == 'websocket_printer' ? 'selected' : '' }}>
                                                WebSocket Service (Backend)
                                            </option>
                                        </select>
                                        <small class="text-muted">
                                            Select your receipt printer type
                                        </small>
                                    </div>

                                    {{-- Connection Method --}}
                                    <div class="col-lg-6 mb-3">
                                        <label for="pos_printer_connection" class="form-label">
                                            <i class="fas fa-plug"></i> Connection Method
                                        </label>
                                        <select class="form-select" id="pos_printer_connection" name="pos_printer_connection">
                                            <option value="browser" {{ old('pos_printer_connection', $settings['pos_printer_connection'] ?? 'browser') == 'browser' ? 'selected' : '' }}>
                                                Browser (window.print)
                                            </option>
                                            <option value="usb" {{ old('pos_printer_connection', $settings['pos_printer_connection'] ?? 'browser') == 'usb' ? 'selected' : '' }}>
                                                USB
                                            </option>
                                            <option value="bluetooth" {{ old('pos_printer_connection', $settings['pos_printer_connection'] ?? 'browser') == 'bluetooth' ? 'selected' : '' }}>
                                                Bluetooth
                                            </option>
                                            <option value="network" {{ old('pos_printer_connection', $settings['pos_printer_connection'] ?? 'browser') == 'network' ? 'selected' : '' }}>
                                                Network (TCP/IP)
                                            </option>
                                        </select>
                                        <small class="text-muted">
                                            How the printer connects to your device
                                        </small>
                                    </div>
                                </div>

                                <div class="row">
                                    {{-- Paper Size --}}
                                    <div class="col-lg-4 mb-3">
                                        <label for="pos_printer_paper_size" class="form-label">
                                            <i class="fas fa-ruler"></i> Paper Size
                                        </label>
                                        <select class="form-select" id="pos_printer_paper_size" name="pos_printer_paper_size">
                                            <option value="58mm" {{ old('pos_printer_paper_size', $settings['pos_printer_paper_size'] ?? '80mm') == '58mm' ? 'selected' : '' }}>
                                                58mm (2.28")
                                            </option>
                                            <option value="80mm" {{ old('pos_printer_paper_size', $settings['pos_printer_paper_size'] ?? '80mm') == '80mm' ? 'selected' : '' }}>
                                                80mm (3.15") - Standard
                                            </option>
                                            <option value="a4" {{ old('pos_printer_paper_size', $settings['pos_printer_paper_size'] ?? '80mm') == 'a4' ? 'selected' : '' }}>
                                                A4 (Letter)
                                            </option>
                                        </select>
                                    </div>

                                    {{-- Auto-cut --}}
                                    <div class="col-lg-4 mb-3">
                                        <label class="form-label d-block">
                                            <i class="fas fa-cut"></i> Auto-cut Paper
                                        </label>
                                        <div class="form-check form-switch mt-2">
                                            <input class="form-check-input" type="checkbox" id="pos_printer_auto_cut" 
                                                   name="pos_printer_auto_cut" value="1" 
                                                   {{ (old('pos_printer_auto_cut', $settings['pos_printer_auto_cut'] ?? true)) ? 'checked' : '' }}>
                                            <label class="form-check-label" for="pos_printer_auto_cut">
                                                Enable auto-cut (if supported)
                                            </label>
                                        </div>
                                    </div>

                                    {{-- Open Cash Drawer --}}
                                    <div class="col-lg-4 mb-3">
                                        <label class="form-label d-block">
                                            <i class="fas fa-cash-register"></i> Cash Drawer
                                        </label>
                                        <div class="form-check form-switch mt-2">
                                            <input class="form-check-input" type="checkbox" id="pos_printer_open_drawer" 
                                                   name="pos_printer_open_drawer" value="1" 
                                                   {{ (old('pos_printer_open_drawer', $settings['pos_printer_open_drawer'] ?? false)) ? 'checked' : '' }}>
                                            <label class="form-check-label" for="pos_printer_open_drawer">
                                                Open cash drawer on print
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                {{-- Network Printer Settings --}}
                                <div id="network-printer-settings" class="printer-section mt-2" style="display: none;">
                                    <div class="border-top pt-2">
                                        <h6 class="mb-2"><i class="fas fa-network-wired"></i> Network Printer Configuration</h6>
                                        <div class="row">
                                            <div class="col-lg-8 mb-3">
                                                <label for="pos_printer_ip" class="form-label">Printer IP Address</label>
                                                <input type="text" class="form-control" id="pos_printer_ip" 
                                                       name="pos_printer_ip" 
                                                       value="{{ old('pos_printer_ip', $settings['pos_printer_ip'] ?? '') }}"
                                                       placeholder="192.168.1.100">
                                            </div>
                                            <div class="col-lg-4 mb-3">
                                                <label for="pos_printer_port" class="form-label">Port</label>
                                                <input type="number" class="form-control" id="pos_printer_port" 
                                                       name="pos_printer_port" 
                                                       value="{{ old('pos_printer_port', $settings['pos_printer_port'] ?? '9100') }}"
                                                       placeholder="9100">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {{-- WebSocket Printer Settings --}}
                                <div id="websocket-printer-settings" class="printer-section mt-2" style="display: none;">
                                    <div class="border-top pt-2">
                                        <h6 class="mb-2"><i class="fas fa-server"></i> WebSocket Printer Service</h6>
                                        <div class="row">
                                            <div class="col-lg-12 mb-3">
                                                <label for="pos_printer_websocket_url" class="form-label">WebSocket Server URL</label>
                                                <input type="text" class="form-control" id="pos_printer_websocket_url" 
                                                       name="pos_printer_websocket_url" 
                                                       value="{{ old('pos_printer_websocket_url', $settings['pos_printer_websocket_url'] ?? 'ws://localhost:8767') }}"
                                                       placeholder="ws://localhost:8767">
                                                <small class="text-muted">URL of your local printer service</small>
                                            </div>
                                        </div>
                                        <div class="alert alert-info mb-0">
                                            <i class="fas fa-info-circle"></i>
                                            Run a backend service to handle printing. Works with any printer type and all devices.
                                        </div>
                                    </div>
                                </div>

                                {{-- Star Micronics Settings --}}
                                <div id="star-printer-settings" class="printer-section mt-2" style="display: none;">
                                    <div class="border-top pt-2">
                                        <h6 class="mb-2"><i class="fas fa-star"></i> Star Micronics Configuration</h6>
                                        <div class="alert alert-info mb-0">
                                            <i class="fas fa-info-circle"></i>
                                            <strong>Supported Models:</strong> TSP100, TSP650, TSP700, mC-Print Series with CloudPRNT or StarWebPRNT
                                        </div>
                                    </div>
                                </div>

                                {{-- Epson Settings --}}
                                <div id="epson-printer-settings" class="printer-section mt-2" style="display: none;">
                                    <div class="border-top pt-2">
                                        <h6 class="mb-2"><i class="fas fa-print"></i> Epson TM Configuration</h6>
                                        <div class="alert alert-info mb-0">
                                            <i class="fas fa-info-circle"></i>
                                            <strong>Supported Models:</strong> TM-T20, TM-T82, TM-T88, TM-m30 with Epson ePOS-Print SDK
                                        </div>
                                    </div>
                                </div>

                                {{-- Browser Print Info --}}
                                <div id="browser-print-info" class="printer-section mt-2">
                                    <div class="alert alert-secondary mb-0">
                                        <i class="fas fa-browser"></i>
                                        <strong>Browser Print:</strong> Uses the standard browser print dialog (window.print). 
                                        Works with any printer installed on your system. Most compatible option for all devices.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="email" role="tabpanel" aria-labelledby="email-tab">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-envelope"></i> Email Account Management
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle"></i>
                                    Manage your email accounts and settings through the dedicated Email Account Manager.
                                    You can add multiple email accounts, configure IMAP/SMTP settings, and organize your emails.
                                </div>

                                <div class="text-center py-4">
                                    <a href="{{ route('admin.email.accounts') }}" class="btn btn-primary btn-lg">
                                        <i class="fas fa-cog"></i> Open Email Account Manager
                                    </a>
                                    <p class="mt-3 text-muted">
                                        <small>Configure multiple email accounts, test connections, and manage your email client settings</small>
                                    </p>
                                </div>

                                <hr>

                                <h6>Quick Email Settings</h6>

                                {{-- Email Client Enabled --}}
                                <div class="mb-2">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="email_client_enabled"
                                               name="email_client_enabled" value="1"
                                               {{ ($settings['email_client_enabled'] ?? true) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="email_client_enabled">
                                            <strong>Enable Email Client</strong>
                                        </label>
                                    </div>
                                    <div class="form-text">
                                        <i class="fas fa-toggle-on"></i> Enable the email client functionality in the admin panel
                                    </div>
                                </div>

                                {{-- Auto-sync --}}
                                <div class="mb-2">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="email_auto_sync"
                                               name="email_auto_sync" value="1"
                                               {{ ($settings['email_auto_sync'] ?? false) ? 'checked' : '' }}>
                                        <label class="form-check-label" for="email_auto_sync">
                                            <strong>Auto-sync Emails</strong>
                                        </label>
                                    </div>
                                    <div class="form-text">
                                        <i class="fas fa-sync"></i> Automatically sync emails from your accounts
                                    </div>
                                </div>

                                {{-- Sync Interval --}}
                                <div class="mb-2">
                                    <label for="email_sync_interval" class="form-label">
                                        <strong>Sync Interval (minutes)</strong>
                                    </label>
                                    <input type="number" class="form-control" id="email_sync_interval" name="email_sync_interval"
                                           value="{{ $settings['email_sync_interval'] ?? 15 }}" min="5" max="1440">
                                    <div class="form-text">
                                        <i class="fas fa-clock"></i> How often to check for new emails (5-1440 minutes)
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

                {{-- Save Button --}}
                <div class="mt-3">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Settings
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@endsection

@section("scripts")
<script>
// Toggle password visibility
document.addEventListener("DOMContentLoaded", function() {
    document.querySelectorAll(".toggle-password").forEach(toggle => {
        toggle.addEventListener("click", function() {
            const targetId = this.getAttribute("data-target");
            const target = document.querySelector(targetId);
            const icon = this.querySelector("i");
            
            if (target.type === "password") {
                target.type = "text";
                icon.classList.remove("fa-eye");
                icon.classList.add("fa-eye-slash");
            } else {
                target.type = "password";
                icon.classList.remove("fa-eye-slash");
                icon.classList.add("fa-eye");
            }
        });
    });
});
</script>
@endsection
